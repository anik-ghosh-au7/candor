{"version":3,"sources":["../../src/controller/chat.db.interface.js"],"names":["dbInterface","userJoin","username","room","Chat","findOneAndUpdate","room_name","upsert","then","result","console","log","err","getRoomUsers","findOne","room_users","active_users","saveChatHistory","body","time","userLeave","module","exports"],"mappings":";;;;;;;;AAAA;;AAEA,IAAIA,WAAW,GAAG;AAEV;AACAC,EAAAA,QAAQ,EAAE,kBAAUC,QAAV,EAAoBC,IAApB,EAA0B;AAChCC,qBAAKC,gBAAL,CAAsB;AAACC,MAAAA,SAAS,EAAEH;AAAZ,KAAtB,EACI;AACI,mBAAa;AACT,wBAAgBD;AADP;AADjB,KADJ,EAKO;AAACK,MAAAA,MAAM,EAAE;AAAT,KALP,EAMKC,IANL,CAMU,UAACC,MAAD,EAAY;AACdC,MAAAA,OAAO,CAACC,GAAR,WAAeT,QAAf,0BAAuCC,IAAvC;AACH,KARL,WASW,UAAAS,GAAG;AAAA,aAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,KATd;AAUH,GAdS;AAgBV;AACAC,EAAAA,YAAY;AAAA,sGAAE,iBAAgBV,IAAhB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,qBAEJC,iBAAKU,OAAL,CAAa;AAACR,gBAAAA,SAAS,EAAEH;AAAZ,eAAb,EACDK,IADC,CACI,UAAAC,MAAM;AAAA,uBAAIM,UAAU,GAAGN,MAAM,CAACO,YAAxB;AAAA,eADV,WAEK,UAAAJ,GAAG;AAAA,uBAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,eAFR,CAFI;;AAAA;AAAA,+CAKHG,UALG;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,KAAF;;AAAA;AAAA;AAAA;;AAAA;AAAA,KAjBF;AAyBV;AACAE,EAAAA,eAAe,EAAE,yBAAUd,IAAV,EAAgBD,QAAhB,EAA0BgB,IAA1B,EAAgCC,IAAhC,EAAsC;AACnDf,qBAAKC,gBAAL,CAAsB;AAACC,MAAAA,SAAS,EAAEH;AAAZ,KAAtB,EACI;AACI,eAAS;AACL,wBAAgB;AACZD,UAAAA,QAAQ,EAARA,QADY;AAEZiB,UAAAA,IAAI,EAAJA,IAFY;AAGZD,UAAAA,IAAI,EAAJA;AAHY;AADX;AADb,KADJ,EASO;AAACX,MAAAA,MAAM,EAAE;AAAT,KATP,EAUKC,IAVL,CAUU,UAACC,MAAD,EAAY;AACdC,MAAAA,OAAO,CAACC,GAAR;AACH,KAZL,WAaW,UAAAC,GAAG;AAAA,aAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,KAbd;AAcH,GAzCS;AA0CV;AACAQ,EAAAA,SAAS,EAAE,mBAAUlB,QAAV,EAAoBC,IAApB,EAA0B;AACjCC,qBAAKC,gBAAL,CAAsB;AAACC,MAAAA,SAAS,EAAEH;AAAZ,KAAtB,EACI;AACI,eAAS;AACL,wBAAgBD;AADX;AADb,KADJ,EAMKM,IANL,CAMU,UAACC,MAAD,EAAY;AACdC,MAAAA,OAAO,CAACC,GAAR,WAAeT,QAAf,wBAAqCC,IAArC;AACH,KARL,WASW,UAAAS,GAAG;AAAA,aAAIF,OAAO,CAACC,GAAR,CAAYC,GAAZ,CAAJ;AAAA,KATd;AAUH;AAtDS,CAAlB;AA0DAS,MAAM,CAACC,OAAP,GAAiBtB,WAAjB","sourcesContent":["import Chat from '../model/chat.model';\r\n\r\nlet dbInterface = {\r\n\r\n        // Join user to chat\r\n        userJoin: function (username, room) {\r\n            Chat.findOneAndUpdate({room_name: room},\r\n                {\r\n                    \"$addToSet\": {\r\n                        \"active_users\": username\r\n                    }\r\n                }, {upsert: true})\r\n                .then((result) => {\r\n                    console.log(`${username} joined room ${room}`);\r\n                })\r\n                .catch(err => console.log(err));\r\n        },\r\n\r\n        // Get room users\r\n        getRoomUsers: async function (room) {\r\n            let room_users;\r\n            await Chat.findOne({room_name: room})\r\n                .then(result => room_users = result.active_users)\r\n                .catch(err => console.log(err));\r\n            return room_users;\r\n        },\r\n\r\n        //Saves chat messages to the database\r\n        saveChatHistory: function (room, username, body, time) {\r\n            Chat.findOneAndUpdate({room_name: room},\r\n                {\r\n                    \"$push\": {\r\n                        \"chat_history\": {\r\n                            username,\r\n                            time,\r\n                            body\r\n                        }\r\n                    }\r\n                }, {upsert: true})\r\n                .then((result) => {\r\n                    console.log(`chat history saved`);\r\n                })\r\n                .catch(err => console.log(err));\r\n        },\r\n        // User leaves chat\r\n        userLeave: function (username, room) {\r\n            Chat.findOneAndUpdate({room_name: room},\r\n                {\r\n                    \"$pull\": {\r\n                        \"active_users\": username\r\n                    }\r\n                })\r\n                .then((result) => {\r\n                    console.log(`${username} left room ${room}`);\r\n                })\r\n                .catch(err => console.log(err));\r\n        },\r\n\r\n    }\r\n;\r\nmodule.exports = dbInterface;\r\n"],"file":"chat.db.interface.js"}
{"version":3,"sources":["../../src/controller/post.controller.js"],"names":["app","post_controller","createPost","req","res","errors","isEmpty","status","json","array","hitUrl","encodeURIComponent","body","url","category","Post","findOne","err","data","send","msg","tag","post_body","match","entry","post","username","post_tags","save","message","redirect","findOneAndUpdate","console","log","favourite_users","title","forEach","elem","messageController","handle_post_comment_messages","createComment","current_url","post_id","post_author","comment_body","comment_username","comment_tags","then","length","slice","renderPost","decodeURIComponent","query","limit","page","parseInt","endIndex","search_by_username","search_username","sort_likes","aggregate","$match","$unwind","result","total_length","$addFields","upvote_count","$size","$sort","$skip","$limit","exec","has_next","next_page","has_prev","prev_page","attach_likes","user","name","render","posts","viewername","getdata","fav","question","admin","related","others","updateLike","like_search_result","add_like","id","upvote_username","delete_like","getTrendingTags","final_result","$group","element","_id","count","sortable","push","sort","a","b","final_str","i","favouriteUsers","flag","userController","removeFavourites","upsert","addFavourites","module","exports","post_outer","user_like","like_count","upvote_users"],"mappings":"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","sourcesContent":["import Post from '../model/post.model';\nimport {validationResult} from 'express-validator';\nimport {ObjectId} from 'mongodb';\nimport messageController from '../controller/message.controller';\nimport userController from '../controller/user.controller';\n\nconst app = {};\n\nconst post_controller = {\n    createPost: (req, res) => {\n        const errors = validationResult(req);\n        if (!errors.isEmpty()) {\n            return res.status(422).json({errors: errors.array()});\n        }\n        ;\n        let hitUrl = `/post/render?current_url=${encodeURIComponent(req.body.url)}&category=${req.body.category}&page=1`;\n        Post.findOne({url: req.body.url}, (err, data) => {\n            if (err) {\n                res.status(500).send({msg: \"Internal Server Error\"});\n            } else {\n\n                const tag = req.body.post_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n                if (!data) {\n                    let entry = new Post({\n                        url: req.body.url,\n                        post: [{\n                            username: req.body.username,\n                            category: req.body.category,\n                            post_tags: tag,\n                            post_body: req.body.post_body\n                        }]\n                    });\n                    entry.save(err => {\n                        if (err) {\n                            res.status(406).send(err.message);\n                        } else {\n                            return res.redirect(hitUrl);\n                        }\n                    });\n                } else {\n                    Post.findOneAndUpdate({url: req.body.url},\n                        {\n                            \"$push\": {\n                                \"post\": {\n                                    username: req.body.username,\n                                    category: req.body.category,\n                                    post_tags: tag,\n                                    post_body: req.body.post_body\n                                }\n                            }\n                        }, {\"new\": true},\n                        err => {\n                            if (err) console.log(err);\n                            res.redirect(hitUrl);\n                        }\n                    );\n                }\n                if (data.favourite_users) {\n                    let title = `New post from ${req.body.username}`\n                    let message = `(Post in ${req.body.category}): ` + req.body.post_body;\n                    data.favourite_users.forEach(elem => {\n                        messageController.handle_post_comment_messages(elem, req.body.username, req.body.url, message, title);\n                    })\n                }\n            }\n\n        })\n\n    },\n    createComment: (req, res) => {\n\n        let current_url = req.body.url;\n        let post_id = req.body.post_id;\n        let post_author = req.body.post_author;\n        let post_body = req.body.post_body;\n        const tag = req.body.comment_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n\n        Post.findOneAndUpdate({url: current_url, \"post._id\": post_id},\n            {\n                \"$push\": {\n                    \"post.$.comments\": {\n                        comment_username: req.body.username,\n                        comment_tags: tag,\n                        comment_body: req.body.comment_body\n                    }\n                }\n            }, {\"new\": true})\n            .then(() => {\n                post_body = post_body.length > 30 ? post_body.slice(0, 30)+ '...' : post_body;\n                let message = `(Comment in ${post_body}): ` + req.body.comment_body;\n                let title = `New comment from ${req.body.username}`\n                messageController.handle_post_comment_messages(post_author, req.body.username, current_url, message, title);\n\n                let hitUrl = `/post/render?current_url=${encodeURIComponent(current_url)}&category=${req.body.category}`;\n                res.redirect(hitUrl)\n            })\n            .catch(err => console.log(err));\n    },\n    renderPost: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let limit = 3;\n        let page = parseInt(req.query.page);\n        const endIndex = page * limit;\n        let total_length;\n        let query;\n        let search_by_username = req.query.search_username;\n        let sort_likes = req.query.sort_likes;\n\n        if (sort_likes) {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        } else {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        }\n\n        query.exec()\n            .then(result => {\n                if (endIndex >= total_length) {\n                    result.has_next = false;\n                } else {\n                    result.has_next = true;\n                    result.next_page = page + 1\n                }\n                if (page === 1) {\n                    result.has_prev = false;\n                } else {\n                    result.has_prev = true;\n                    result.prev_page = page - 1\n                }\n                attach_likes(result, req.user.name);\n\n                res.render('index', {\n                    posts: result,\n                    url: current_url,\n                    viewername: req.user.name,\n                    category,\n                    user: req.user\n                })\n            })\n            .catch(err => console.log(err));\n    },\n    getdata: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let data = {};\n        data.fav = false;\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'question'}}]).then(result => {\n            data.question = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'admin'}}]).then(result => {\n            data.admin = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'related'}}]).then(result => {\n            data.related = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'others'}}]).then(result => {\n            data.others = result.length\n        });\n        await Post.findOne({url: current_url}).then(result => {\n            if (result) {\n            result.favourite_users.forEach(elem => {\n                if(elem === req.user.name) {\n                    data.fav = true;\n                }\n            });\n            };\n        });\n        res.status(200).send(data);\n    },\n    updateLike: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let post_id = req.query.post_id;\n        let like_search_result = {};\n\n        const add_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$push\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('liked');\n                })\n                .catch(err => console.log(err));\n        };\n        const delete_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$pull\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('unliked');\n                })\n                .catch(err => console.log(err));\n        };\n\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post._id': ObjectId(post_id)}}, {$unwind: '$post.upvote_users'}, {$match: {'post.upvote_users.upvote_username': req.user.name}}])\n            .then((result) => {\n                like_search_result[req.user.name] = result;\n                if (like_search_result[req.user.name].length === 0) {\n                    add_like(current_url, post_id, req.user.name);\n                } else {\n                    delete_like(current_url, post_id, req.user.name);\n                }\n                ;\n                delete like_search_result[req.user.name];\n            })\n            .catch(err => console.log(err));\n\n    },\n    getTrendingTags: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let final_result = {};\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$match: {'post.post_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.post_tags'},\n            {$group: {'_id': {'post_tags': '$post.post_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                result.forEach(element => {\n                    final_result[element._id.post_tags] = element.count;\n                });\n            })\n            .catch(err => console.log(err))\n\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$unwind: '$post.comments'},\n            {$match: {'post.comments.comment_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.comments.comment_tags'},\n            {$group: {'_id': {'comment_tags': '$post.comments.comment_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                    result.forEach(element => {\n                        if (!final_result[element._id.comment_tags]) {\n                            final_result[element._id.comment_tags] = element.count;\n                        } else {\n                            final_result[element._id.comment_tags] += element.count;\n                        }\n                    });\n                    let sortable = [];\n                    for (let result in final_result) {\n                        sortable.push([result, final_result[result]]);\n                    }\n\n                    sortable.sort((a, b) => {\n                        return b[1] - a[1];\n                    });\n                    let final_str = '<ul class=\"list-group\">';\n                    sortable = sortable.slice(0, 10);\n                    for (let i = 0; i < sortable.length; i += 1) {\n                        final_str += '<li class=\"list-group-item d-flex justify-content-between align-items-center\">' +\n                            sortable[i][0] +\n                            `<span class=\"badge badge-primary badge-pill\">${sortable[i][1]}</span></li>`;\n                    }\n                    final_str += '</ul>';\n                    res.send(final_str)\n                }\n            )\n            .catch(err => console.log(err))\n    },\n\n    favouriteUsers: async (req, res) => {\n        // console.log(req.body);\n        let username = req.user.name;\n        let url = req.body.current_url;\n        let flag = false;\n        await Post.findOne({url}).then(result => {\n            // console.log('result findOne', result.favourite_users);\n            if (result) {\n            result.favourite_users.forEach(elem => {\n                if(elem === username) {\n                    flag = true;\n                }\n            });\n            };\n        });\n\n        if (flag) {\n            // console.log('inside if --> ', flag);\n            Post.findOneAndUpdate({url}, {\n                \"$pull\": {\n                    \"favourite_users\": username\n                }\n            }, {\"new\": true})\n            .then(() => {\n                userController.removeFavourites(username, url);\n                console.log(`${username} removed from ${url} favourites!!!`);\n                res.send(`removed from favourites!!!`);\n            })\n            .catch(err => console.log(err));\n        } else {\n            // console.log('inside else --> ', flag);\n            Post.findOneAndUpdate({url}, {\n                \"$push\": {\n                    \"favourite_users\": username\n                }\n            }, {upsert: true})\n            .then(() => {\n                userController.addFavourites(username, url);\n                console.log(`${username} added to ${url} favourites!!!`);\n                res.send(`added to favourites!!!`);\n            })\n            .catch(err => console.log(err));\n        }\n    }\n};\nmodule.exports = {post_controller, app};\n\nfunction attach_likes(result, name) {\n    let post_outer;\n    for (post_outer of result) {\n        post_outer.post.user_like = false;\n        post_outer.post.like_count = post_outer.post.upvote_users.length;\n        let user;\n        for (user of post_outer.post.upvote_users) {\n            if (user.upvote_username === name) {\n                post_outer.post.user_like = true;\n            }\n        }\n    }\n}\n"],"file":"post.controller.js"}
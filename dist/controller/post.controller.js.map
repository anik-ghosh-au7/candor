{"version":3,"sources":["../../src/controller/post.controller.js"],"names":["app","post_controller","createPost","req","res","errors","isEmpty","status","json","array","hitUrl","encodeURIComponent","body","url","category","Post","findOne","err","data","send","msg","tag","post_body","match","entry","post","username","post_tags","save","message","redirect","findOneAndUpdate","console","log","favourite_users","forEach","elem","messageController","handle_post_messages","createComment","current_url","post_id","comment_body","comment_username","comment_tags","then","renderPost","decodeURIComponent","query","limit","page","parseInt","endIndex","search_by_username","search_username","sort_likes","aggregate","$match","$unwind","result","total_length","length","$addFields","upvote_count","$size","$sort","$skip","$limit","exec","has_next","next_page","has_prev","prev_page","attach_likes","user","name","render","posts","viewername","getdata","fav","question","admin","related","others","updateLike","like_search_result","add_like","id","upvote_username","delete_like","getTrendingTags","final_result","$group","element","_id","count","sortable","push","sort","a","b","final_str","slice","i","favouriteUsers","flag","upsert","module","exports","post_outer","user_like","like_count","upvote_users"],"mappings":"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","sourcesContent":["import Post from '../model/post.model';\nimport {validationResult} from 'express-validator';\nimport {ObjectId} from 'mongodb';\nimport messageController from '../controller/message.controller';\n\nconst app = {};\n\nconst post_controller = {\n    createPost: (req, res) => {\n        const errors = validationResult(req);\n        if (!errors.isEmpty()) {\n            return res.status(422).json({errors: errors.array()});\n        }\n        ;\n        let hitUrl = `/post/render?current_url=${encodeURIComponent(req.body.url)}&category=${req.body.category}&page=1`;\n        Post.findOne({url: req.body.url}, (err, data) => {\n            if (err) {\n                res.status(500).send({msg: \"Internal Server Error\"});\n            } else {\n\n                const tag = req.body.post_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n                if (!data) {\n                    let entry = new Post({\n                        url: req.body.url,\n                        post: [{\n                            username: req.body.username,\n                            category: req.body.category,\n                            post_tags: tag,\n                            post_body: req.body.post_body\n                        }]\n                    });\n                    entry.save(err => {\n                        if (err) {\n                            res.status(406).send(err.message);\n                        } else {\n                            return res.redirect(hitUrl);\n                        }\n                    });\n                } else {\n                    Post.findOneAndUpdate({url: req.body.url},\n                        {\n                            \"$push\": {\n                                \"post\": {\n                                    username: req.body.username,\n                                    category: req.body.category,\n                                    post_tags: tag,\n                                    post_body: req.body.post_body\n                                }\n                            }\n                        }, {\"new\": true},\n                        err => {\n                            if (err) console.log(err);\n                            res.redirect(hitUrl);\n                        }\n                    );\n                }\n                if (data.favourite_users) {\n                    let message = `(Post in ${req.body.category}) ` + req.body.post_body;\n                    data.favourite_users.forEach(elem => {\n                        messageController.handle_post_messages(elem, req.body.username, req.body.url, message);\n                    })\n                }\n            }\n\n        })\n\n    },\n    createComment: (req, res) => {\n\n        let current_url = req.body.url;\n        let post_id = req.body.post_id;\n        const tag = req.body.comment_body.match(/(#[\\w!@#$%^&*()_+\\-=\\[\\]{};':\"\\\\|,.<>\\/?]+)/g);\n\n        Post.findOneAndUpdate({url: current_url, \"post._id\": post_id},\n            {\n                \"$push\": {\n                    \"post.$.comments\": {\n                        comment_username: req.body.username,\n                        comment_tags: tag,\n                        comment_body: req.body.comment_body\n                    }\n                }\n            }, {\"new\": true})\n            .then(() => {\n                let hitUrl = `/post/render?current_url=${encodeURIComponent(current_url)}&category=${req.body.category}`;\n                res.redirect(hitUrl)\n            })\n            .catch(err => console.log(err));\n\n    },\n    renderPost: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let limit = 3;\n        let page = parseInt(req.query.page);\n        const endIndex = page * limit;\n        let total_length;\n        let query;\n        let search_by_username = req.query.search_username;\n        let sort_likes = req.query.sort_likes;\n\n        if (sort_likes) {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$addFields: {upvote_count: {$size: \"$post.upvote_users\"}}}, {\n                    $sort: {\n                        \"upvote_count\": -1,\n                        'post.post_time': -1\n                    }\n                }, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        } else {\n            if (search_by_username) {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {\n                    $match: {\n                        'post.category': category,\n                        'post.username': search_by_username\n                    }\n                }, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            } else {\n                await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}]).then(result => total_length = result.length).catch(err => console.log(err));\n                query = Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': category}}, {$sort: {'post.post_time': -1}}, {$skip: (page - 1) * limit}, {$limit: limit}])\n            }\n        }\n\n        query.exec()\n            .then(result => {\n                if (endIndex >= total_length) {\n                    result.has_next = false;\n                } else {\n                    result.has_next = true;\n                    result.next_page = page + 1\n                }\n                if (page === 1) {\n                    result.has_prev = false;\n                } else {\n                    result.has_prev = true;\n                    result.prev_page = page - 1\n                }\n                attach_likes(result, req.user.name);\n\n                res.render('index', {\n                    posts: result,\n                    url: current_url,\n                    viewername: req.user.name,\n                    category,\n                    user: req.user\n                })\n            })\n            .catch(err => console.log(err));\n    },\n    getdata: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let data = {};\n        data.fav = false;\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'question'}}]).then(result => {\n            data.question = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'admin'}}]).then(result => {\n            data.admin = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'related'}}]).then(result => {\n            data.related = result.length\n        });\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post.category': 'others'}}]).then(result => {\n            data.others = result.length\n        });\n        await Post.findOne({url: current_url}).then(result => {\n            if (result) {\n            result.favourite_users.forEach(elem => {\n                if(elem === req.user.name) {\n                    data.fav = true;\n                }\n            });\n            };\n        });\n        res.status(200).send(data);\n    },\n    updateLike: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let post_id = req.query.post_id;\n        let like_search_result = {};\n\n        const add_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$push\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('liked');\n                })\n                .catch(err => console.log(err));\n        };\n        const delete_like = (url, id, name) => {\n            Post.findOneAndUpdate({url, \"post._id\": id},\n                {\n                    \"$pull\": {\n                        \"post.$.upvote_users\": {\n                            upvote_username: name\n                        }\n                    }\n                }, {\"new\": true})\n                .then((result) => {\n                    res.send('unliked');\n                })\n                .catch(err => console.log(err));\n        };\n\n        await Post.aggregate([{$match: {url: current_url}}, {$unwind: '$post'}, {$match: {'post._id': ObjectId(post_id)}}, {$unwind: '$post.upvote_users'}, {$match: {'post.upvote_users.upvote_username': req.user.name}}])\n            .then((result) => {\n                like_search_result[req.user.name] = result;\n                if (like_search_result[req.user.name].length === 0) {\n                    add_like(current_url, post_id, req.user.name);\n                } else {\n                    delete_like(current_url, post_id, req.user.name);\n                }\n                ;\n                delete like_search_result[req.user.name];\n            })\n            .catch(err => console.log(err));\n\n    },\n    getTrendingTags: async (req, res) => {\n        let current_url = decodeURIComponent(req.query.current_url);\n        let category = req.query.category;\n        let final_result = {};\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$match: {'post.post_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.post_tags'},\n            {$group: {'_id': {'post_tags': '$post.post_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                result.forEach(element => {\n                    final_result[element._id.post_tags] = element.count;\n                });\n            })\n            .catch(err => console.log(err))\n\n        await Post.aggregate([{$match: {url: current_url}},\n            {$unwind: '$post'},\n            {$match: {'post.category': category}},\n            {$unwind: '$post.comments'},\n            {$match: {'post.comments.comment_tags': {\"$exists\": true, \"$ne\": null}}},\n            {$unwind: '$post.comments.comment_tags'},\n            {$group: {'_id': {'comment_tags': '$post.comments.comment_tags'}, 'count': {'$sum': 1}}}])\n            .then(result => {\n                    result.forEach(element => {\n                        if (!final_result[element._id.comment_tags]) {\n                            final_result[element._id.comment_tags] = element.count;\n                        } else {\n                            final_result[element._id.comment_tags] += element.count;\n                        }\n                    });\n                    let sortable = [];\n                    for (let result in final_result) {\n                        sortable.push([result, final_result[result]]);\n                    }\n\n                    sortable.sort((a, b) => {\n                        return b[1] - a[1];\n                    });\n                    let final_str = '<ul class=\"list-group\">';\n                    sortable = sortable.slice(0, 10);\n                    for (let i = 0; i < sortable.length; i += 1) {\n                        final_str += '<li class=\"list-group-item d-flex justify-content-between align-items-center\">' +\n                            sortable[i][0] +\n                            `<span class=\"badge badge-primary badge-pill\">${sortable[i][1]}</span></li>`;\n                    }\n                    final_str += '</ul>';\n                    res.send(final_str)\n                }\n            )\n            .catch(err => console.log(err))\n    },\n\n    favouriteUsers: async (req, res) => {\n        // console.log(req.body);\n        let username = req.user.name;\n        let url = req.body.current_url;\n        let flag = false;\n        await Post.findOne({url}).then(result => {\n            // console.log('result findOne', result.favourite_users);\n            if (result) {\n            result.favourite_users.forEach(elem => {\n                if(elem === username) {\n                    flag = true;\n                }\n            });\n            };\n        });\n\n        if (flag) {\n            // console.log('inside if --> ', flag);\n            Post.findOneAndUpdate({url}, {\n                \"$pull\": {\n                    \"favourite_users\": username\n                }\n            }, {\"new\": true})\n            .then(() => {\n                console.log(`${username} removed from ${url} favourites!!!`);\n                res.send(`removed from favourites!!!`);\n            })\n            .catch(err => console.log(err));\n        } else {\n            // console.log('inside else --> ', flag);\n            Post.findOneAndUpdate({url}, {\n                \"$push\": {\n                    \"favourite_users\": username\n                }\n            }, {upsert: true})\n            .then(() => {\n                console.log(`${username} added to ${url} favourites!!!`);\n                res.send(`added to favourites!!!`);\n            })\n            .catch(err => console.log(err));\n        }\n    }\n};\nmodule.exports = {post_controller, app};\n\nfunction attach_likes(result, name) {\n    let post_outer;\n    for (post_outer of result) {\n        post_outer.post.user_like = false;\n        post_outer.post.like_count = post_outer.post.upvote_users.length;\n        let user;\n        for (user of post_outer.post.upvote_users) {\n            if (user.upvote_username === name) {\n                post_outer.post.user_like = true;\n            }\n        }\n    }\n}\n"],"file":"post.controller.js"}